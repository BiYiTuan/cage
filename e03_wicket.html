<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Feb 12, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Cage - Captcha Generator - </title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20110212" />
    <meta http-equiv="Content-Language" content="en" />
                                                    
<meta content="cage, captcha, java, maven" name="keywords"/>
                                                        
<meta content="Cage is a CAPTCHA image generator java library. It is fast, small and simple. Its goal is to generate images that are easy to read for a human but impossible or at least very hard for a computer." name="description"/>
                      
  </head>
  <body class="composite">
    <div id="banner">
                  <a href="index.html" id="bannerLeft">
                Cage - CAptcha GEnerator Java Library
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2011-02-12</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="index.html" title="About">About</a>
            |
                        <a href="quickstart.html" title="QuickStart">QuickStart</a>
            |
                        <a href="templates.html" title="Templates">Templates</a>
            |
                        <a href="examples.html" title="Examples">Examples</a>
            |
                        <a href="download.html" title="Download">Download</a>
            |
                        <a href="help_and_feedback.html" title="Help & Feedback">Help & Feedback</a>
            |
                        <a href="apidocs/index.html" title="Javadoc">Javadoc</a>
              
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="About">About</a>
            </li>
                  <li class="none">
                          <a href="quickstart.html" title="QuickStart">QuickStart</a>
            </li>
                  <li class="none">
                          <a href="templates.html" title="Templates">Templates</a>
            </li>
                                                                                                            <li class="expanded">
                          <a href="examples.html" title="Examples">Examples</a>
                    <ul>
                      <li class="none">
                          <a href="e01_simple.html" title="Simple">Simple</a>
            </li>
                      <li class="none">
                          <a href="e02_servlet.html" title="Servlet">Servlet</a>
            </li>
                      <li class="none">
            <strong>Wicket</strong>
          </li>
              </ul>
        </li>
                  <li class="none">
                          <a href="download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="help_and_feedback.html" title="Help & Feedback">Help & Feedback</a>
            </li>
                  <li class="none">
                          <a href="apidocs/index.html" title="Javadoc">Javadoc</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                            <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Wicket Example<a name="Wicket_Example"></a></h2><p>The complete source code for this example is available in the <a class="externalLink" href="https://github.com/akiraly/cage/tree/master/cage-examples-parent/cage-e03-wicket">git repo</a>.</p><div class="section"><h3>Overview<a name="Overview"></a></h3><p>This example shows how you can integrate Cage into a wicket app. This is a wicket 1.5 RC1 (1.4 would be not much different) + standard Java Servlet 2.5 web application. This is the wicket equivalent of the <a href="./e02_servlet.html">servlet example</a>. The aim of the app is to show a form with a captcha and an input field. The user has to type in the correct text seen on the picture. The app shows a good or a bad message depending on the user input equaling the token.</p><p>Four relevant files are in this project. A HomePage.java class representing our page and holding all the logic. A HomePage.html is the view for this page. A WicketApplication class and the standard web.xml descriptor for initializing wicket.</p></div><div class="section"><h3>HomePage.java<a name="HomePage.java"></a></h3><p>This is the most important file of this app. It shows how the page is composed in wicket and how a <a href="./apidocs/com/github/cage/GCage.html">GCage</a> object is used for captcha generation. This class uses cage.draw(String token) method which returns the image in a byte[] form. The array is written to the response by wicket.</p><div class="source"><pre>public class HomePage extends WebPage {
  private static final long serialVersionUID = 3303458191832318970L;
  private static final Cage cage = new GCage();

  private String token = cage.getTokenGenerator().next();
  private String captcha;
  private boolean showGoodResult;
  private boolean showBadResult;

  public HomePage() {
    add(new WebMarkupContainer(&quot;goodResult&quot;) {
      private static final long serialVersionUID = -5279236538017405828L;

      @Override
      protected void onConfigure() {
        super.onConfigure();
        setVisible(showGoodResult);
        showGoodResult = false;
      }
    });
    add(new WebMarkupContainer(&quot;badResult&quot;) {
      private static final long serialVersionUID = -6479933043124566245L;

      @Override
      protected void onConfigure() {
        super.onConfigure();
        setVisible(showBadResult);
        showBadResult = false;
      }
    });

    add(new Form&lt;HomePage&gt;(&quot;form&quot;,
        new CompoundPropertyModel&lt;HomePage&gt;(this)) {
      private static final long serialVersionUID = -2783383042739263677L;

      @Override
      protected void onInitialize() {
        super.onInitialize();
        add(new RequiredTextField&lt;String&gt;(&quot;captcha&quot;) {
          private static final long serialVersionUID = 8416111619173955610L;

          @Override
          protected void onComponentTag(ComponentTag tag) {
            super.onComponentTag(tag);
            tag.put(&quot;value&quot;, &quot;&quot;);
          };
        }.add(new StringValidator() {
          private static final long serialVersionUID = 3888825725858419028L;

          @Override
          protected void onValidate(IValidatable&lt;String&gt; validatable) {
            if (token == null
                || !token.equals(validatable.getValue()))
              error(validatable);
          }
        }));
      }

      @Override
      protected void onSubmit() {
        super.onSubmit();
        onPost(true);
      }

      @Override
      protected void onError() {
        super.onError();
        onPost(false);
      }

      protected void onPost(boolean good) {
        showGoodResult = good;
        showBadResult = !good;
        token = cage.getTokenGenerator().next();
      }
    });

    add(new NonCachingImage(&quot;captchaImage&quot;, new DynamicImageResource(
        cage.getFormat()) {
      private static final long serialVersionUID = -1475355045487272906L;

      @Override
      protected byte[] getImageData(Attributes attributes) {
        return cage.draw(token);
      }
    }));
  }

  public String getToken() {
    return token;
  }

  public String getCaptcha() {
    return captcha;
  }

  public void setCaptcha(String captcha) {
    this.captcha = captcha;
  }
}
</pre></div></div><div class="section"><h3>HomePage.html<a name="HomePage.html"></a></h3><p>This is the view. A plain html with a few wicket:id attributes.</p><div class="source"><pre>&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;
  xmlns:wicket=&quot;http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;title&gt;Captcha Reader&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1 wicket:id=&quot;goodResult&quot; style=&quot;color: green;&quot;&gt;Your kung fu is good!&lt;/h1&gt;
    &lt;h1 wicket:id=&quot;badResult&quot; style=&quot;color: red;&quot;&gt;This is not right. Try again!&lt;/h1&gt;
    &lt;p&gt;Type in the word seen on the picture&lt;/p&gt;
    &lt;form wicket:id=&quot;form&quot;&gt;
      &lt;input wicket:id=&quot;captcha&quot; type=&quot;text&quot; autocomplete=&quot;off&quot; /&gt;
      &lt;input type=&quot;submit&quot; /&gt;
    &lt;/form&gt;
    &lt;img wicket:id=&quot;captchaImage&quot; alt=&quot;captcha image&quot; /&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></div></div><div class="section"><h3>WicketApplication.java<a name="WicketApplication.java"></a></h3><p>Central class of the wicket web application. Not much in it. Tells wicket to use our HomePage class as starting page. Also configures view encoding to UTF-8 and turns on html compression (cool stuff).</p><div class="source"><pre>public class WicketApplication extends WebApplication {
  @Override
  public Class&lt;? extends Page&gt; getHomePage() {
    return HomePage.class;
  }

  @Override
  protected void init() {
    super.init();

    getMarkupSettings().setDefaultMarkupEncoding(CharEncoding.UTF_8);
    getMarkupSettings().setCompressWhitespace(true);
  }
}
</pre></div></div><div class="section"><h3>web.xml<a name="web.xml"></a></h3><p>The snippet below starts up wicket in deployment mode. All requests of the web application go trough the wicket filter so both the page and the captcha image can be served by it.</p><div class="source"><pre>&lt;context-param&gt;
  &lt;param-name&gt;wicket.configuration&lt;/param-name&gt;
  &lt;param-value&gt;deployment&lt;/param-value&gt;
&lt;/context-param&gt;

&lt;filter&gt;
  &lt;filter-name&gt;wicketApp&lt;/filter-name&gt;
  &lt;filter-class&gt;org.apache.wicket.protocol.http.WicketFilter&lt;/filter-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;applicationClassName&lt;/param-name&gt;
    &lt;param-value&gt;com.github.cage.cage_e03_wicket.WicketApplication&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
  &lt;filter-name&gt;wicketApp&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">Copyright &#169;                   2011.
          All Rights Reserved.      
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
